@model DTO.Invoice.FreezedFamilyInvoiceViewModel
@using System.Globalization;
@using Web.Utils;
@{

    int applicantFamilyStructureId = (int)ViewBag.ApplicantFamilyStructureId;
    int applicantQuantity = 0;
}

<div class="row">
    <div class="col-md-12">
        <table class="display table table-striped table-bordered table-condensed" style="border-collapse: collapse !important; width:100%;">
            <thead>
                <tr>
                    <th>Parentesco</th>
                    <th>Nome</th>
                    <th>Local</th>
                    <th class="text-center">
                        <div class="row">
                            <div class="col-md-12">Certidão</div>
                        </div>
                        <hr />
                        <div class="row">
                            <div class="col-md-6">
                                <input type="checkbox" id="SelecionarTodosCertBra" />
                                <label for="SelecionarTodosCertBra"><small>BRA</small></label>
                            </div>
                            <div class="col-md-6">
                                <input type="checkbox" id="SelecionarTodosCertIta" />
                                <label for="SelecionarTodosCertIta"><small>ITA</small></label>
                            </div>
                        </div>
                    </th>
                    <th class="text-center">
                        <div class="row">
                            <div class="col-md-12">Trad.</div>
                        </div>
                        <hr />
                        <div class="row">
                            <div class="col-md-12">
                                <label><small>&nbsp;</small></label>
                                <input type="checkbox" id="SelecionarTodasTrad" />
                                <label><small>&nbsp;</small></label>
                            </div>
                        </div>
                    </th>
                    <th class="text-center">
                        <div class="row">
                            <div class="col-md-12">Apost.</div>
                        </div>
                        <hr />
                        <div class="row">
                            <div class="col-md-12">
                                <label><small>&nbsp;</small></label>
                                <input type="checkbox" id="SelecionarTodasApos" />
                                <label><small>&nbsp;</small></label>
                            </div>
                        </div>
                    </th>
                    <th class="text-center">
                        <div class="row">
                            <div class="col-md-12">CNN</div>
                        </div>
                        <hr />
                        <div class="row">
                            <div class="col-md-12">
                                <label><small>&nbsp;</small></label>
                                <input type="checkbox" id="SelecionarTodasCNN" />
                                <label><small>&nbsp;</small></label>
                            </div>

                        </div>
                    </th>
                </tr>
            </thead>
            <tbody>
                @foreach (var item in Model.FreezedFamilyItemViewModel.OrderByDescending(x => x.FamilyStructureId))
                {
                    <tr class="tr-freezed-family-item" data-freezed-family-item-id="@item.FreezedFamilyItemId">
                        <td class="text-center">@item.FamilyStructureDescription</td>
                        <td class="text-center">@item.FullName</td>

                        @if (item.FamilyStructureId == applicantFamilyStructureId)
                        {
                            applicantQuantity++;

                            <td style="font-size: 0.8em;">
                                <div class="row"><div class="col-sm-4 text-left text-nowrap"><b>Nascimento: </b></div><div class="col-sm-8"></div></div>
                                <div class="row"><div class="col-sm-4 text-left text-nowrap"><b>Casamento: </b></div><div class="col-sm-8"></div></div>
                            </td>
                            <td style="white-space: nowrap; font-size: 0.8em;">
                                <div class="row">
                                    <div class="col-sm-6 text-center">
                                        <input id="@string.Format("birth-{0}-bra", item.FreezedFamilyItemId)" class="cert" data-country="bra" data-type="birth" type="checkbox" @if (item.BirthCertificateBRA) { <text> checked</text>} />&nbsp;<label for="@string.Format("birth-{0}-bra", item.FreezedFamilyItemId)">BRA</label>
                                    </div>
                                    <div class="col-sm-6 text-center">
                                        <input id="@string.Format("birth-{0}-ita", item.FreezedFamilyItemId)" class="cert" data-country="ita" data-type="birth" type="checkbox" @if (item.BirthCertificateITA) { <text> checked</text>} />&nbsp;<label for="@string.Format("birth-{0}-ita", item.FreezedFamilyItemId)">ITA</label>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-sm-6 text-center">
                                        <input id="@string.Format("marriage-{0}-bra", item.FreezedFamilyItemId)" class="cert" data-country="bra" data-type="marriage" type="checkbox" @if (item.MarriageCertificateBRA) { <text> checked</text>} />&nbsp;<label for="@string.Format("marriage-{0}-bra", item.FreezedFamilyItemId)">BRA</label>
                                    </div>
                                    <div class="col-sm-6 text-center">
                                        <input id="@string.Format("marriage-{0}-ita", item.FreezedFamilyItemId)" class="cert" data-country="ita" data-type="marriage" type="checkbox" @if (item.MarriageCertificateITA) { <text> checked</text>} />&nbsp;<label for="@string.Format("marriage-{0}-ita", item.FreezedFamilyItemId)">ITA</label>
                                    </div>
                                </div>
                            </td>
                            <td>
                                <div class="row">
                                    <div class="col-sm-12 text-center">
                                        <input class="trans" data-country="bra" data-type="birth" type="checkbox" @if (item.BirthCertificateTranslation) { <text> checked</text>} /><label>&nbsp;</label>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-sm-12 text-center">
                                        <input class="trans" data-country="bra" data-type="marriage" type="checkbox" @if (item.MarriageCertificateTranslation) { <text> checked</text>} /><label>&nbsp;</label>
                                    </div>
                                </div>
                            </td>
                            <td>
                                <div class="row">
                                    <div class="col-sm-12 text-center">
                                        <input class="apost" data-country="bra" data-type="birth" type="checkbox" @if (item.BirthCertificateHaiaHandout) { <text> checked</text>} /><label>&nbsp;</label>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-sm-12 text-center">
                                        <input class="apost" data-country="bra" data-type="marriage" type="checkbox" @if (item.MarriageCertificateHaiaHandout) { <text> checked</text>} /><label>&nbsp;</label>
                                    </div>
                                </div>
                            </td>
                            <td>
                                <div class="row">
                                    <div class="col-sm-12 text-center">
                                        <input class="cnn" type="checkbox" @if (item.CNN) { <text> checked</text>} /><label>&nbsp;</label>
                                    </div>
                                </div>
                            </td>
                        }
                        else
                        {
                            <td style="font-size: 0.8em;">
                                <div class="row"><div class="col-sm-4 text-nowrap"><b>Nascimento: </b></div><div class="col-sm-8">@item.BirthPlace @(item.BirthDate.HasValue ? "em " + item._BirthDate : "")</div></div>
                                <div class="row"><div class="col-sm-4 text-nowrap"><b>Casamento: </b></div><div class="col-sm-8">@item.MarriagePlace @(item.MarriageDate.HasValue ? "em " + item._MarriageDate : "")</div></div>
                                <div class="row"><div class="col-sm-4 text-nowrap"><b>Óbito: </b></div><div class="col-sm-8">@item.DeathPlace @(item.DeathDate.HasValue ? "em " + item._DeathDate : "")</div></div>
                            </td>
                            <td style="white-space: nowrap; font-size: 0.8em;">
                                <div class="row">
                                    <div class="col-sm-6 text-center">
                                        <input id="@string.Format("birth-{0}-bra", item.FreezedFamilyItemId)" class="cert" data-country="bra" data-type="birth" type="checkbox" @if (item.BirthCertificateBRA) { <text> checked</text>} />&nbsp;<label for="@string.Format("birth-{0}-bra", item.FreezedFamilyItemId)">BRA</label>
                                    </div>
                                    <div class="col-sm-6 text-center">
                                        <input id="@string.Format("birth-{0}-ita", item.FreezedFamilyItemId)" class="cert" data-country="ita" data-type="birth" type="checkbox" @if (item.BirthCertificateITA) { <text> checked</text>} />&nbsp;<label for="@string.Format("birth-{0}-ita", item.FreezedFamilyItemId)">ITA</label>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-sm-6 text-center">
                                        <input id="@string.Format("marriage-{0}-bra", item.FreezedFamilyItemId)" class="cert" data-country="bra" data-type="marriage" type="checkbox" @if (item.MarriageCertificateBRA) { <text> checked</text>} />&nbsp;<label for="@string.Format("marriage-{0}-bra", item.FreezedFamilyItemId)">BRA</label>
                                    </div>
                                    <div class="col-sm-6 text-center">
                                        <input id="@string.Format("marriage-{0}-ita", item.FreezedFamilyItemId)" class="cert" data-country="ita" data-type="marriage" type="checkbox" @if (item.MarriageCertificateITA) { <text> checked</text>} />&nbsp;<label for="@string.Format("marriage-{0}-ita", item.FreezedFamilyItemId)">ITA</label>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-sm-6 text-center">
                                        <input id="@string.Format("death-{0}-bra", item.FreezedFamilyItemId)" class="cert" data-country="bra" data-type="death" type="checkbox" @if (item.DeathCertificateBRA) { <text> checked</text>} />&nbsp;<label for="@string.Format("death-{0}-bra", item.FreezedFamilyItemId)">BRA</label>
                                    </div>
                                    <div class="col-sm-6 text-center">
                                        <input id="@string.Format("death-{0}-ita", item.FreezedFamilyItemId)" class="cert" data-country="ita" data-type="death" type="checkbox" @if (item.DeathCertificateITA) { <text> checked</text>} />&nbsp;<label for="@string.Format("death-{0}-ita", item.FreezedFamilyItemId)">ITA</label>
                                    </div>
                                </div>
                            </td>
                            <td style="white-space: nowrap; font-size: 0.8em;">
                                <div class="row">
                                    <div class="col-sm-12 text-center">
                                        <input class="trans" data-type="birth" data-country="bra" type="checkbox" @if (item.BirthCertificateTranslation) { <text> checked</text>} /><label>&nbsp;</label>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-sm-12 text-center">
                                        <input class="trans" data-type="marriage" data-country="bra" type="checkbox" @if (item.MarriageCertificateTranslation) { <text> checked</text>} /><label>&nbsp;</label>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-sm-12 text-center">
                                        <input class="trans" data-type="death" data-country="bra" type="checkbox" @if (item.DeathCertificateTranslation) { <text> checked</text>} /><label>&nbsp;</label>
                                    </div>
                                </div>
                            </td>
                            <td style="white-space: nowrap; font-size: 0.8em;">
                                <div class="row">
                                    <div class="col-sm-12 text-center">
                                        <input class="apost" data-type="birth" data-country="bra" type="checkbox" @if (item.BirthCertificateHaiaHandout) { <text> checked</text>} /><label>&nbsp;</label>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-sm-12 text-center">
                                        <input class="apost" data-type="marriage" data-country="bra" type="checkbox" @if (item.MarriageCertificateHaiaHandout) { <text> checked</text>} /><label>&nbsp;</label>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-sm-12 text-center">
                                        <input class="apost" data-type="death" data-country="bra" type="checkbox" @if (item.DeathCertificateHaiaHandout) { <text> checked</text>} /><label>&nbsp;</label>
                                    </div>
                                </div>
                            </td>
                            <td>
                                <div class="row">
                                    <div class="col-sm-12 text-center">
                                        <input class="cnn" type="checkbox" @if (item.CNN) { <text> checked</text>} /><label>&nbsp;</label>
                                    </div>
                                </div>
                            </td>
                        }
                    </tr>
                }
                <tr style="font-size: 0.8em;">
                    <td colspan="3" class="text-right"><b>Quantidade:</b></td>
                    <td class="text-center"><span id="total-cert-count">0</span></td>
                    <td class="text-center"><span id="total-trans-count">0</span></td>
                    <td class="text-center"><span id="total-apost-count">0</span></td>
                    <td class="text-center"><span id="total-cnn-count">0</span></td>
                </tr>
                <tr style="font-size: 0.8em;">
                    <td colspan="3" class="text-right"><b>Valor:</b></td>
                    <td class="text-center">R$ <span id="total-cert-price">0,00</span></td>
                    <td class="text-center">R$ <span id="total-trans-price">0,00</span></td>
                    <td class="text-center">R$ <span id="total-apost-price">0,00</span></td>
                    <td class="text-center">R$ <span id="total-cnn-price">0,00</span></td>
                </tr>
                <tr style="border-top: 2px solid #999; background-color: rgba(255, 216, 0, 0.2);">
                    <td colspan="3" class="text-right"><b>Quantidade Total de Documentos/Serviços:</b></td>
                    <td colspan="4" class="text-center">
                        <b><span id="total-cert-trans-apost-count">0</span></b>
                    </td>
                </tr>
                <tr style="background-color: rgba(255, 216, 0, 0.2);">
                    <td colspan="3" class="text-right"><b>Detalhes dos Documentos/Serviços:</b></td>
                    <td colspan="4" class="text-center">
                        <b>BRA = <span id="qtd-cert-bra">0</span> | ITA = <span id="qtd-cert-ita">0</span> | CNN = <span id="qtd-cnn">0</span> | Serviços = <span id="qtd-services">0</span></b>
                    </td>
                </tr>
                <tr style="background-color: rgba(255, 216, 0, 0.2);">
                    <td colspan="3" class="text-right"><b>Valor Total dos Documentos/Serviços:</b></td>
                    <td colspan="4" class="text-center"><b>R$ <span id="total-cert-trans-apost-price">0,00</span></b></td>
                </tr>
                <tr style="border-left-color: white; border-right-color: white; background-color: white;">
                    <td style="border-left-color: white; border-right-color: white;" colspan="7" class="text-center">
                        &nbsp;
                    </td>
                </tr>
                <tr style="font-size: 0.8em;">
                    <td colspan="3" class="text-right"><b>Custo Procuração Italiana:</b></td>
                    <td colspan="4" class="text-center"><b>R$ <span id="total-letter-of-attorney-qtd-cost">0,00</span></b></td>
                </tr>
                <tr style="font-size: 0.8em;">
                    <td colspan="3" class="text-right"><b>Abertura do Processo:</b></td>
                    <td colspan="4" class="text-center"><b>R$ <span id="total-process-cost">0,00</span></b></td>
                </tr>
                <tr style="font-size: 0.8em;">
                    <td colspan="3" class="text-right"><b>Custas por Requerente (14 anos mínimos):</b></td>
                    <td colspan="4" class="text-center"><b>R$ <span id="total-applicant-qtd-cost">0,00</span></b></td>
                </tr>
                <tr style="border-top: 2px solid #999; background-color: rgba(255, 216, 0, 0.2);">
                    <td colspan="3" class="text-right"><b>Custo Itália:</b></td>
                    <td colspan="4" class="text-center">
                        <b><span id="total-ita-cost">0,00</span></b>
                    </td>
                </tr>
                <tr style="border-left-color: white; border-right-color: white; background-color: white;">
                    <td style="border-left-color: white; border-right-color: white;" colspan="7" class="text-center">
                        &nbsp;
                    </td>
                </tr>
                @foreach (var item in Model.InvoiceItemViewModel)
                {
                    <tr style="font-size: 0.8em;" class="tr-service" data-service-type-id="@item.InvoiceItemServiceTypeId" data-name="@item.InvoiceItemServiceTypeName" data-service-is-credit="@item.InvoiceItemServiceTypeIsCredit" data-masked-value="@item._Value" data-value="@item.Value.ToString("0.00", System.Globalization.CultureInfo.InvariantCulture)" onmouseenter="showRemoveService(this)" onmouseleave="hideRemoveService(this)">
                        <td colspan="3" class="text-right">
                            <b>@item.InvoiceItemServiceTypeName:</b>
                        </td>
                        <td colspan="4" class="text-center">
                            @if (item.InvoiceItemServiceTypeIsCredit)
                            {
                                <span>R$ @item._Value</span>
                            }
                            else
                            {
                                <span style="color:red;">R$ -@item._Value</span>
                            }
                            <a href="javascript:void(0)" onclick="removeService(this)" class="remove-service float-right" style="display:none;"><i class="iconsminds-remove"></i></a>
                        </td>
                    </tr>
                }
                <tr style="font-size: 0.8em;" id="tr-new-service">
                    <td colspan="3" class="text-right"><b>Itens Adicionais:</b></td>
                    @if (User.InvoiceCanAccessEdition())
                    {
                        <td colspan="4" class="text-center"><a href="javascript:void(0)" data-toggle="modal" data-target="#NewServiceModal" class="simple-icon-plus"></a></td>
                    }
                    else
                    {
                        <td colspan="4" class="text-center"></td>
                    }
                </tr>
                <tr style="border-top: 2px solid black; background-color: rgba(255, 216, 0, 0.2);">
                    <td colspan="3" class="text-right"><b>Valor Total dos Serviços Adicionais:</b></td>
                    <td colspan="4" class="text-center"><b id="total-service-price-color">R$ <span id="total-service-price">0,00</span></b></td>
                </tr>
                <tr style="border-left-color: white; border-right-color: white; background-color: white;">
                    <td style="border-left-color: white; border-right-color: white;" colspan="7" class="text-center">
                        &nbsp;
                    </td>
                </tr>
                <tr style="font-size: 0.8em;">
                    <td colspan="3" class="text-right"><b>Valor Total:</b></td>
                    <td colspan="4" class="text-center"><b>R$ <span id="total">0.00</span></b></td>
                </tr>
                <tr style="font-size: 0.8em;">
                    <td colspan="3" class="text-right"><b>Imposto:</b></td>
                    <td colspan="4" class="text-center"><b id="tax"></b></td>
                </tr>
                <tr style="font-size: 0.8em; display:none;" id="InvoicePaymentTypeArea" onchange="openPaymentDateModal()">
                    <td colspan="3" class="text-right"><b>Parcelamento:</b></td>
                    <td colspan="4" class="text-center">
                        <select class="form-control" id="InvoicePaymentTypeId" name="InvoicePaymentTypeId" style="text-align-last:center;font-size: 12px; height: 30px;"></select>
                    </td>
                </tr>
                @if (Model.InvoicePaymentViewModel.Count > 0)
                {
                    for (var i = 0; i < Model.InvoicePaymentViewModel.Count; i++)
                    {
                        <tr style="font-size: 0.8em;" class="tr-installments" data-installment-date="@Model.InvoicePaymentViewModel[i]._InstallmentDate" data-value="@Model.InvoicePaymentViewModel[i].Price.ToString(CultureInfo.InvariantCulture)">

                            <td colspan="3" class="text-right"><b>Parcela @(i + 1) @*(@Model.InvoicePaymentViewModel[i]._InstallmentDate)*@:</b></td>
                            <td colspan="4" class="text-center">
                                <b>@Model.InvoicePaymentViewModel[i]._Price</b>
                            </td>
                        </tr>
                    }
                }
                <tr style="border-top: 2px solid black; background-color: rgba(255, 216, 0, 0.2);">
                    <td colspan="3" class="text-right"><b>Valor Final:</b></td>
                    <td colspan="4" class="text-center"><b>R$ <span id="grand-total">0.00</span></b></td>
                </tr>
                <tr style="background-color: rgba(255, 216, 0, 0.2);">
                    <td colspan="3" class="text-right"><b>Valor Final por Requerente - @applicantQuantity Requerente(s):</b></td>
                    <td colspan="4" class="text-center"><b>R$ <span id="grand-total-applicant">0.00</span></b></td>
                </tr>
            </tbody>
        </table>
    </div>
</div>

<div class="modal fade" id="PaymentDateModal" tabindex="-1" role="dialog" data-backdrop="static" data-keyboard="false">
    <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Parcelamento</h5>
            </div>
            <div class="modal-body">
                <input type="hidden" id="InstallmentDay" />
                <div class="row">
                    <div class="col-md-12">
                        <label>
                            Data da primeira parcela:&nbsp;
                            <input type="text" id="paymentDay" style="width:20px; background-color: #f0f1f4;border: none; border-radius: 5px;" maxlength="2" />/@DateTime.Now.AddMonths(1).Month.ToString("00")/@DateTime.Now.Year.ToString()
                        </label>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary" onclick="selectInstallmentDay()">Salvar</button>
                <script type="text/javascript">
                    $('#PaymentDateModal').on('shown.bs.modal', function (e) {
                        $('#paymentDay').focus();
                    });
                    function openPaymentDateModal() {
                        //var paymentTimes = $('#InvoicePaymentTypeId option[value="' + $('#InvoicePaymentTypeId').val() + '"]').data('times');

                        //if (paymentTimes != null && paymentTimes > 0) {
                        //    $('#PaymentDateModal').modal('show');
                        //} else {
                        //    getInvoicePaymentTypePrice();
                        //}
                        getInvoicePaymentTypePrice();
                    }

                    function selectInstallmentDay() {
                        if (!jQuery.isNumeric($('#paymentDay').val())) { //check if text contains only number
                            $('#paymentDay').val('');
                            alert('Digite apenas números.');
                            return;
                        } else { //check if it's a valid date
                            var day = parseInt($('#paymentDay').val());

                            var currentDate = new Date();
                            currentDate.setMonth(currentDate.getMonth() + 1);
                            var totalDaysInMonth = getTotalDaysInMonth(currentDate.getMonth(), currentDate.getFullYear());

                            if (day < 0 || day > totalDaysInMonth) {
                                $('#paymentDay').val('');
                                alert('Digite um dia válido.');
                                return;
                            }
                        }

                        $('#InstallmentDay').val($('#paymentDay').val());
                        $('#paymentDay').val('');
                        $('#PaymentDateModal').modal('hide');

                        getInvoicePaymentTypePrice();
                    }
                </script>
            </div>
        </div>
    </div>
</div>

<script type="text/javascript">
    function getBRACertsCount() {
        return $('input[class=cert][data-country=bra]:checked').length;
    }
    function getBRACertsPrice() {
        var certBra = $('#CERT-BRA').cleanVal() / 100;

        return getBRACertsCount() * certBra;
    }

    function getITACertsCount() {
        return $('input[class=cert][data-country=ita]:checked').length;
    }
    function getITACertsPrice() {
        var eur = $('#EUR').cleanVal() / 100;
        var certIta = $('#CERT-ITA').cleanVal() / 100;

        return getITACertsCount() * certIta * eur;
    }

    function fillCertsText() {
        $('#total-cert-count').text(getBRACertsCount() + getITACertsCount());
        $('#qtd-cert-bra').text(getBRACertsCount());
        $('#qtd-cert-ita').text(getITACertsCount());
        $('#total-cert-price').text((getBRACertsPrice() + getITACertsPrice()).toLocaleString('pt-BR', { minimumFractionDigits: 2, maximumFractionDigits: 2 }));
    }

    $('.cert, #EUR, #CERT-BRA, #CERT-ITA').change(function () {
        fillCertsText();
        fillCertsTransApostText();
        fillProcessCostText();
        fillApplicantCostText();
        fillLetterOfAttorneyText();
        fillItaCostText();
        fillGrandTotalText();
    });

    $('#CONFIG-TAX').change(function () {
        tax = !$('#CONFIG-TAX').cleanVal() ? 0 : $('#CONFIG-TAX').cleanVal() / 100;
        getInvoicePaymentTypePrice();
    });
</script>
<script type="text/javascript">
    function getTransCount() {
        return $('input[class=trans]:checked').length;
    }
    function getTransPrice() {
        var transBra = $('#TRANS-BRA').cleanVal() / 100;

        return getTransCount() * transBra;
    }

    function fillTransText() {
        $('#total-trans-count').text(getTransCount());
        $('#qtd-services').text(getApostCount() + getTransCount());
        $('#total-trans-price').text(getTransPrice().toLocaleString('pt-BR', { minimumFractionDigits: 2, maximumFractionDigits: 2 }));
    }

    $('.trans, #TRANS-BRA').change(function () {
        fillTransText();
        fillCertsTransApostText();
        fillGrandTotalText();
    });
</script>
<script type="text/javascript">
    function getApostCount() {
        return $('input[class=apost]:checked').length;
    }
    function getApostPrice() {
        var apostBra = $('#APOST-BRA').cleanVal() / 100;

        return getApostCount() * apostBra;
    }

    function fillApostText() {
        $('#total-apost-count').text(getApostCount());
        $('#qtd-services').text(getApostCount() + getTransCount());
        $('#total-apost-price').text(getApostPrice().toLocaleString('pt-BR', { minimumFractionDigits: 2, maximumFractionDigits: 2 }));
    }

    $('.apost, #APOST-BRA').change(function () {
        fillApostText();
        fillCertsTransApostText();
        fillGrandTotalText();
    });
</script>
<script type="text/javascript">
    function getCNNCount() {
        return $('input[class=cnn]:checked').length;
    }
    function getCNNPrice() {
        var cnn = $('#CNN').cleanVal() / 100;

        return getCNNCount() * cnn;
    }

    function fillCNNText() {
        $('#total-cnn-count').text(getCNNCount());
        $('#qtd-cnn').text(getCNNCount());
        $('#total-cnn-price').text(getCNNPrice().toLocaleString('pt-BR', { minimumFractionDigits: 2, maximumFractionDigits: 2 }));
    }

    $('.cnn, #CNN').change(function () {
        fillCNNText();
        fillCertsTransApostText();
        fillGrandTotalText();
    });
</script>
<script type="text/javascript">
    function getCertTransApostPrice() {
        return getBRACertsPrice() + getITACertsPrice() + getTransPrice() + getApostPrice() + getCNNPrice();
    }
    // VALOR TOTAL DOS DOCUMENTOS COM TAXA
    function getCertTransApostPriceWithTaxes() {
        return getCertTransApostPrice() + (getCertTransApostPrice() / 100.0 * tax);
    }

    function getValueDocsWithTaxes() {
        var value = getCertTransApostPrice() + getLetterOfAttorneyCost();
        return value + (value / 100 * tax);
    }

    function fillCertsTransApostText() {
        $('#total-cert-trans-apost-count').text(getBRACertsCount() + getITACertsCount() + getTransCount() + getApostCount() + getCNNCount());
        $('#total-cert-trans-apost-price').text((getBRACertsPrice() + getITACertsPrice() + getTransPrice() + getApostPrice() + getCNNPrice()).toLocaleString('pt-BR', { minimumFractionDigits: 2, maximumFractionDigits: 2 }));
    }
</script>
<script type="text/javascript">
    $('#PROCESS-COST').change(function () {
        fillProcessCostText();
        fillItaCostText();
        fillGrandTotalText();
    });
    function getProcessCost() {
        var eur = $('#EUR').cleanVal() / 100;
        var processCost = $('#PROCESS-COST').cleanVal() / 100;

        return processCost * eur;
    }
    function fillProcessCostText() {
        $('#total-process-cost').text(getProcessCost().toLocaleString('pt-BR', { minimumFractionDigits: 2, maximumFractionDigits: 2 }));
    }

    //VALOR TOTAL DA ABERTURA COM TAXA
    function getProcessCostWithTaxes() {
        return getProcessCost() + (getProcessCost() / 100.0 * tax);
    }
</script>
<script type="text/javascript">
    $('#APPLICANT-COST').change(function () {
        fillApplicantCostText();
        fillItaCostText();
        fillGrandTotalText();
    });
    function getApplicantCost() {
        var eur = $('#EUR').cleanVal() / 100;
        var applicantCost = $('#APPLICANT-COST').cleanVal() / 100;

        return (@applicantQuantity * applicantCost) * eur;
    }
    function fillApplicantCostText() {
        $('#total-applicant-qtd-cost').text(getApplicantCost().toLocaleString('pt-BR', { minimumFractionDigits: 2, maximumFractionDigits: 2 }));
    }
</script>
<script type="text/javascript">
    $('#LETTEROFATTORNEY-COST').change(function () {
        fillLetterOfAttorneyText();
        fillItaCostText();
        fillGrandTotalText();
    });
    function getLetterOfAttorneyCost() {
        var letterOfAttorneyCost = $('#LETTEROFATTORNEY-COST').cleanVal() / 100;

        return @applicantQuantity * letterOfAttorneyCost;
    }
    function fillLetterOfAttorneyText() {
        $('#total-letter-of-attorney-qtd-cost').text(getLetterOfAttorneyCost().toLocaleString('pt-BR', { minimumFractionDigits: 2, maximumFractionDigits: 2 }));
    }
</script>
<script type="text/javascript">
    function getItaCost() {
        return getProcessCost() + getApplicantCost() + getLetterOfAttorneyCost();
    }
    function fillItaCostText() {
        $('#total-ita-cost').text(getItaCost().toLocaleString('pt-BR', { minimumFractionDigits: 2, maximumFractionDigits: 2 }));
    }
</script>
<script type="text/javascript">
    function serviceValidation() {
        var hasError = false;
        $('.text-danger').remove();

        if (IsNullOrWhiteSpace($('#ServiceValue').val())) {
            hasError = true;
            $('#ServiceValue').after($('<div>', { class: 'text-danger' }).append('Preencha o valor.'));
        }

        if (!hasError) {
            if (getGrandTotal() + getServiceValue($('#ServiceValue').cleanVal() / 100, $('#ServiceIsCredit').val()) < 0) {
                hasError = true;
                $('#ServiceValue').after($('<div>', { class: 'text-danger' }).append('Ao acrescentar esse valor o orçamento ficará negativo.'));
            }
        }

        return !hasError;
    }

    function addServiceOnTable() {
        var tr = $('<tr>', { class: 'tr-service', style: 'font-size: 0.8em', onmouseenter: 'showRemoveService(this)', onmouseleave: 'hideRemoveService(this)' });

        var val = $('#ServiceValue').cleanVal() / 100;

        tr.data('service-type-id', $('#ServiceTypeId').val());
        tr.data('name', $('#ServiceTypeId option:selected').data('name'));
        tr.data('service-is-credit', $('#ServiceIsCredit').val());
        tr.data('value', val);
        tr.data('masked-value', $('#ServiceValue').val());

        var td1 = $('<td>', { colspan: '3', class: 'text-right' }).append('<b>' + $('#ServiceTypeId option[value="' + $('#ServiceTypeId').val() + '"]').data('name') + ':</b>');
        var td2 = $('<td>', { colspan: '4', class: 'text-center' });

        var isCredit = $('#ServiceIsCredit').val() == true || $('#ServiceIsCredit').val() == 'True';

        td2.append('<span ' + (isCredit ? '' : 'style="color:red;"') + '>R$ ' + (isCredit ? '' : '-') + val.toLocaleString('pt-BR', { minimumFractionDigits: 2, maximumFractionDigits: 2 }) + '</span>');
        td2.append('<a href="javascript:void(0)" onclick="removeService(this)" class="remove-service float-right" style="display:none;"><i class="iconsminds-remove"></i></a>');

        $('#tr-new-service').before(tr.append(td1, td2));

        $('#NewServiceModal').modal('hide');

        updateServiceTR();
        fillServiceText();
    }
    function updateServiceTR() {
        $.each($('.tr-service'), function (i, e) {
            $(e).data('id', i);
            $(e).find('.remove-service').data('id', i);
        });
    }
    function removeService(_this) {
        var id = $(_this).data('id');

        $.each($('.tr-service'), function (i, e) {
            if ($(e).data('id') == id) $(e).remove();
        });

        updateServiceTR();
        fillServiceText();
    }

    function showRemoveService(_this) {
        $('.remove-service').hide();
        $(_this).find('.remove-service').show();
    }

    function hideRemoveService() {
        $('.remove-service').hide();
    }
    function getServiceValue(val, serviceIsCredit) {
        if (serviceIsCredit == true || serviceIsCredit == 'True') {
            return parseFloat(val);
        } else {
            return -parseFloat(val);
        }
    }
    function getServicePrice() {
        var servicePrice = 0;
        $.each($('.tr-service'), function (i, e) {
            servicePrice += getServiceValue($(e).data('value'), $(e).data('service-is-credit'));
        });

        return servicePrice;
    }
    function fillServiceText() {
        var servicePrice = getServicePrice();
        $('#total-service-price-color').css('color', servicePrice < 0 ? 'red' : '');
        $('#total-service-price').text(servicePrice.toLocaleString('pt-BR', { minimumFractionDigits: 2, maximumFractionDigits: 2 }));

        fillGrandTotalText();
        getInvoicePaymentTypePrice();

    }

    function getValueProcessCost() {
        return $('#PROCESS-COST').cleanVal() / 100;
    }

    function getCotacaoEuro() {
        return $('#EUR').cleanVal() / 100;
    }

    function getNoAireSubscription() {
        return (5000);
    }


</script>
<script type="text/javascript">
    function fillGrandTotalText() {
        var grandTotal = getGrandTotal();

        $('#tax').text(tax.toLocaleString('pt-BR', { minimumFractionDigits: 2, maximumFractionDigits: 2 }) + '%');
        $('#total').text(grandTotal.toLocaleString('pt-BR', { minimumFractionDigits: 2, maximumFractionDigits: 2 }));
        $('#grand-total').text((getGrandTotalWithTaxes()).toLocaleString('pt-BR', { minimumFractionDigits: 2, maximumFractionDigits: 2 }));
        $('#grand-total-applicant').text(((getGrandTotalWithTaxes()) / @applicantQuantity).toLocaleString('pt-BR', { minimumFractionDigits: 2, maximumFractionDigits: 2 }));


    }
    function getGrandTotal() {

        return getCertTransApostPrice() + getItaCost() + getServicePrice();



    }
    function getGrandTotalWithTaxes() {
        var grandTotal = getGrandTotal();

        grandTotal += grandTotal * (tax / 100);
        grandTotal += grandTotal * (getPaymentTypeTaxes() / 100);
        return grandTotal;
    }


    function getPaymentTypeTaxes() {
        var installmentTaxes = $('#InvoicePaymentTypeId option[value="' + $('#InvoicePaymentTypeId').val() + '"]').data('tax');

        return installmentTaxes == null ? 0 : installmentTaxes;

    }
</script>
<script type="text/javascript">
    $(document).ready(function () {
        fillCertsText();
        fillTransText();
        fillApostText();
        fillCNNText();
        fillCertsTransApostText();
        fillProcessCostText();
        fillApplicantCostText();
        fillLetterOfAttorneyText();
        fillItaCostText();

        fillServiceText();
        updateServiceTR();

        fillGrandTotalText();


        $('#SelecionarTodosCertBra').click(function () {
            $('.cert[data-country="bra"]').prop('checked', $(this).prop('checked'));

            fillCertsText();
            fillCertsTransApostText();
            fillGrandTotalText();
            getInvoicePaymentTypePrice()
        });
        $('#SelecionarTodosCertIta').click(function () {
            $('.cert[data-country="ita"]').prop('checked', $(this).prop('checked'));

            fillCertsText();
            fillCertsTransApostText();
            fillGrandTotalText();
            getInvoicePaymentTypePrice()
        });
        $('#SelecionarTodasTrad').click(function () {
            $('.trans[data-country="bra"]').prop('checked', $(this).prop('checked'));

            fillTransText();
            fillCertsTransApostText();
            fillGrandTotalText();
            getInvoicePaymentTypePrice()
        });
        $('#SelecionarTodasApos').click(function () {
            $('.apost[data-country="bra"]').prop('checked', $(this).prop('checked'));

            fillApostText();
            fillCertsTransApostText();
            fillGrandTotalText();
            getInvoicePaymentTypePrice()
        });
        $('#SelecionarTodasCNN').click(function () {
            $('.cnn').prop('checked', $(this).prop('checked'));

            fillCNNText();
            fillCertsTransApostText();
            fillGrandTotalText();
            getInvoicePaymentTypePrice();
        });

        _MaskData();
    });
</script>

@{ await Html.RenderPartialAsync("~/Views/Shared/Components/FreezedFamilyInvoice/Shared/NewServiceModal.cshtml"); }

@if (!User.InvoiceCanAccessEdition())
{
    <script type="text/javascript">
        disabledFields();
    </script>
}